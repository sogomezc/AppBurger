<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Burger - Login</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/assets/css/estilos.css">
    <link rel="stylesheet" href="/assets/css/login.css">
</head>

<body class="body-login">
  
  <div class="login-wrapper">
    <a href="#" id="close-login" class="close-button"><i class="bi bi-x-lg"></i></a>
    <div class="container" id="container">
    
      <div class="form-container register-container">
        <form id="registerForm">
          <h1>Regístrate aquí</h1>
          <input type="text" placeholder="Nombre" id="register-nombre" required>
          <input type="email" placeholder="Email" id="register-email" required>
          <input type="password" placeholder="Contraseña" id="register-password" required>
          
          <button type="submit" class="btn-register">Regístrate</button>
          <span>o usa tu cuenta</span>
          <div class="social-container">
            <a href="#" class="social"><i class="bi bi-google"></i></a>
            <a href="#" class="social"><i class="bi bi-facebook"></i></a>
            <a href="#" class="social"><i class="bi bi-instagram"></i></a>
          </div>
        </form>
      </div>

      <div class="form-container login-container">
        <form id="loginForm">
          <h1>Iniciar Sesión</h1>
          <input type="email" placeholder="Email" id="email" required>
          <input type="password" placeholder="Contraseña" id="password" required>
          <div class="content">
            <div class="checkbox">
              <input type="checkbox" name="checkbox" id="checkbox">
              <label>Recordar</label>
            </div>
            <div class="pass-link">
              <a href="#">¿Olvidaste tu contraseña?</a>
            </div>
          </div>
          <button type="submit" class="btn-register">Iniciar Sesión</button>
          <span>o usa tu cuenta</span>
          <div class="social-container">
            <a href="#" class="social"><i class="bi bi-google"></i></a>
            <a href="#" class="social"><i class="bi bi-facebook"></i></a>
            <a href="#" class="social"><i class="bi bi-instagram"></i></a>
          </div>
        </form>
      </div>

      <div class="overlay-container">
        <div class="overlay">
          <div class="overlay-panel overlay-left">
            <h1 class="title">Bienvenido a <br> Golden Burger</h1>
            <p>Las mejores hamburguesas de la quinta región.</p>
            <button class="ghost" id="login">Iniciar Sesión</button>
          </div>
          <div class="overlay-panel overlay-right">
            <h1 class="title">Comienza <br> Registrándote</h1>
            <p>Obtén un 10% de descuento en tu primera compra al registrarte.</p>
            <button class="ghost" id="register">Registro</button>
          </div>
        </div>
      </div>

    </div> 
  </div>

  <script src="/assets/js/login.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/js/dataBase.js"></script>
  
  <script>
    // Espera a que todo el HTML de la página esté cargado antes de ejecutar el script.
    document.addEventListener('DOMContentLoaded', function() {
      
      // --- LÓGICA PARA EL FORMULARIO DE LOGIN ---
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        
        loginForm.addEventListener('submit', function(e) {
          // Previene que la página se recargue, que es el comportamiento por defecto de un formulario.
          e.preventDefault();
          
          // Obtiene los valores escritos por el usuario en los campos de email y contraseña.
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;

          // Busca en la lista de usuarios si alguno coincide con el email y contraseña ingresados.
          const usuarioValido = window.usuarios.find(u => u.email === email && u.password === password);

          // Si se encontró un usuario válido...
          if (usuarioValido) {
            // Guarda en el navegador que el usuario ha iniciado sesión y su nombre.
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userName', usuarioValido.nombre);
            
            // Lógica de redirección segñun si es admin o cliente
            if (usuarioValido.email === 'admin@profesor.duocuc.cl') {
              // Si es el admin, lo envía directamente a su panel de control.
              window.location.href = '/paginasAdmin/dashboard.html';
            } else {
              // Si es un cliente, lo envía a la página de inicio o a la que intentaba visitar antes.
              const redirectUrl = localStorage.getItem('redirectAfterLogin') || '/index.html';
              localStorage.removeItem('redirectAfterLogin'); 
              window.location.href = redirectUrl;
            }

          } else {
            // Si no se encontró un usuario, muestra un mensaje de error.
            alert("Email o contraseña incorrectos");
          }
        });
      }

      // --- LÓGICA DE REGISTRO ---
      const registerForm = document.getElementById('registerForm');
      if (registerForm) {
        // Se activa cuando el usuario intenta enviar el formulario de registro.
        registerForm.addEventListener('submit', function(e) {
          e.preventDefault();
          // Obtiene los valores de los campos de registro.
          const nombre = document.getElementById('register-nombre').value;
          const email = document.getElementById('register-email').value.trim(); // .trim() elimina espacios
          const password = document.getElementById('register-password').value;

          // Validación 1: Campos vacíos
          if (!nombre || !email || !password) {
            alert('Por favor, completa todos los campos.');
            return; // Detiene el proceso
          }

          // Validación 2: Dominio del correo
          const emailValido = 
              email.endsWith('@duocuc.cl') || 
              email.endsWith('@profesor.duocuc.cl') || 
              email.endsWith('@gmail.com');

          if (!emailValido) {
            alert('El correo debe tener un dominio válido: @duocuc.cl, @profesor.duocuc.cl o @gmail.com');
            return; // Detiene el proceso
          }
        
          // Validación 3: El email no debe existir previamente
          const emailExistente = window.usuarios.some(u => u.email === email);
          if (emailExistente) {
            alert('Este email ya está registrado.');
            return; // Detiene el proceso
          }

          // Si todas las validaciones pasan, crea el nuevo objeto de usuario.
          const newUser = { nombre, email, password };
          // Lo añade a la lista de usuarios en memoria.
          window.usuarios.push(newUser);
          // Guarda la lista de usuarios actualizada y permanente en el navegador.
          localStorage.setItem('usuarios', JSON.stringify(window.usuarios));

          // Informa al usuario y limpia el formulario.
          alert('¡Registro exitoso! Ahora puedes iniciar sesión.');
          registerForm.reset();
          // Simula un clic en el botón "Iniciar Sesión" para cambiar de panel.
          document.getElementById('login').click();
        });
      }

      // --- LÓGICA DEL BOTÓN DE CIERRE "X" ---
      const closeButton = document.getElementById('close-login');
      if (closeButton) {
        closeButton.addEventListener('click', function(event) {
          event.preventDefault(); // Evita que el enlace '#' mueva la página.
          history.back();       // Envía al usuario a la página anterior en su historial.
        });
      }
    });
  </script>

</body>
</html>