<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Pedidos</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; display:flex; background:#f4f4f4; }
    .sidebar { width:220px; height:100vh; background:#000000; color:white; padding-top:30px; position:fixed; left:0; top:0; display:flex; flex-direction:column; justify-content:space-between; }
    .sidebar h2 { text-align:center; margin-bottom:30px; }
    .sidebar ul { list-style:none; padding:0; }
    .sidebar ul li { padding:15px; cursor:pointer; transition:background 0.3s; }
    .sidebar ul li:hover { background:#f6b343; }
    .sidebar a { color:white; text-decoration:none; display:block; }
    .content { margin-left:220px; padding:20px; width:calc(100% - 220px); }
    table { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    th, td { padding:12px 15px; border-bottom:1px solid #ddd; text-align:left; }
    th { background:#000000; color:white; }
    tr:hover { background:#f1f1f1; }
    button { margin-right:5px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
    .deleteBtn { background:#c0392b; color:white; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <h2>Golden Burger</h2>
      <ul>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="gestorClientes.html">Clientes</a></li>
        <li><a href="gestorPedidos.html">Pedidos</a></li>
        <li><a href="productos.html">Productos</a></li>
      </ul>
    </div>
    <div style="padding:20px;">
      <a href="login.html" 
      style="display:block;
      background:#f39c12;
      color:white;
      text-align:center;
      padding:10px;
      border-radius:8px;
      text-decoration:none;
      font-weight:bold;
      margin-bottom: 50px;
      ">Cerrar Sesión
      </a>
    </div>
  </div>

  <div class="content">
    <h1>Gestión de Pedidos</h1>

    <!-- Formulario -->
    <form id="formPedido">
      <input type="text" id="nombre" placeholder="Nombre Cliente" required>
      <select id="producto" required>
        <option value="">Seleccione Producto</option>
      </select>
      <button type="submit">Agregar Pedido</button>
    </form>

    <table id="tablaPedidos">
      <thead>
        <tr>
          <th>#</th>
          <th>Fecha</th>
          <th>Nombre Cliente</th>
          <th>Producto</th>
          <th>Monto</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // Catálogo de productos
    const catalogo = [
      { nombre: "Combo Clásica", precio: 7990 },
      { nombre: "Clásica", precio: 6990 },
      { nombre: "Champiñon", precio: 8790 },
      { nombre: "Triple Queso", precio: 9990 },
      { nombre: "Golden", precio: 7990 },
      { nombre: "Bacon BBQ", precio: 8990 },
      { nombre: "Italiana", precio: 6290 },
      { nombre: "Spicy Clásica", precio: 7790 },
      { nombre: "Bacon Cheeseburger Clásica", precio: 6990 },
      { nombre: "Cheeseburger", precio: 7890 },
      { nombre: "Papas Golden", precio: 6990 },
      { nombre: "Chicken Pop", precio: 6990 },
      { nombre: "Coca-cola", precio: 1490 },
      { nombre: "Coca-cola Zero", precio: 1490 },
      { nombre: "Fanta", precio: 1490 },
      { nombre: "Sprite", precio: 1490 },
      { nombre: "Jumex", precio: 1490 },
      { nombre: "Avocado Kids", precio: 3890 },
      { nombre: "Play Queso", precio: 3890 }
    ];

    // Llenar select de productos
    const selectProducto = document.getElementById('producto');
    catalogo.forEach(p => {
      const option = document.createElement('option');
      option.value = p.nombre;
      option.textContent = `${p.nombre} - $${p.precio}`;
      selectProducto.appendChild(option);
    });

    const form = document.getElementById('formPedido');
    const tbody = document.querySelector('#tablaPedidos tbody');

    // Pedidos y usuarios desde localStorage
    let pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
    let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

    function renderTabla() {
      tbody.innerHTML = '';
      pedidos.forEach((p, i) => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td>${i+1}</td>
          <td>${p.fecha}</td>
          <td>${p.nombre}</td>
          <td>${p.producto}</td>
          <td>$${p.monto}</td>
          <td>
            <button class="deleteBtn" onclick="eliminarPedido(${i})">Eliminar</button>
          </td>
        `;
        tbody.appendChild(fila);
      });

      // Guardar siempre en localStorage
      localStorage.setItem('pedidos', JSON.stringify(pedidos));
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const nombre = document.getElementById('nombre').value.trim();
      const productoNombre = selectProducto.value;
      if(!productoNombre) return alert('Seleccione un producto');

      const producto = catalogo.find(p => p.nombre === productoNombre);
      const fecha = new Date().toLocaleDateString();
      const monto = producto.precio;

      // Guardar pedido
      const nuevoPedido = { fecha, nombre, producto: producto.nombre, monto };
      pedidos.push(nuevoPedido);

      // Crear o actualizar cliente automáticamente
      let usuario = usuarios.find(u => u.nombreCliente === nombre);
      if(!usuario){
        usuarios.push({
          nombreCliente: nombre,
          fechaRegistro: fecha,
          tipoCliente: 'Cliente',
          estado: 'Activo',
          productos: [{ nombre: producto.nombre, precio: producto.precio, cantidad:1 }]
        });
      } else {
        // Actualizar productos existentes
        const prodExistente = usuario.productos.find(p => p.nombre === producto.nombre);
        if(prodExistente) prodExistente.cantidad += 1;
        else usuario.productos.push({ nombre: producto.nombre, precio: producto.precio, cantidad:1 });
      }

      // Guardar cambios en localStorage
      localStorage.setItem('pedidos', JSON.stringify(pedidos));
      localStorage.setItem('usuarios', JSON.stringify(usuarios));

      form.reset();
      renderTabla();
    });

    function eliminarPedido(index) {
      if(confirm('¿Deseas eliminar este pedido?')){
        const pedidoEliminado = pedidos.splice(index,1)[0];
        const usuario = usuarios.find(u => u.nombreCliente === pedidoEliminado.nombre);
        if(usuario){
          const prodIndex = usuario.productos.findIndex(p => p.nombre === pedidoEliminado.producto);
          if(prodIndex > -1) usuario.productos.splice(prodIndex,1);
          if(usuario.productos.length === 0) usuarios = usuarios.filter(u => u.nombreCliente !== usuario.nombreCliente);
        }
        renderTabla();
      }
    }

    renderTabla();
  </script>
</body>
</html>
